\pgfplotstableset{
	begin table={\rowcolors{2}{gray!25}{white}\begin{tabular}},
	end table=\end{tabular},
}

% Собственные обозначения для скобок
\newcommand{\roubr}[1]{\left(#1\right)}  % round  brackets ()
\newcommand{\sqbr}[1]{\left[#1\right]}   % sqaure brackets [] 
\newcommand{\cubr}[1]{\left\{#1\right\}} % curtly brackets {}

% Жирный текст в математике
\newcommand{\mb}[1]{\mathbf{#1}}

\newcommand{\myd}[1]{\operatorname{d}\!#1}

% Дивергенция и градиент
\newcommand{\mydiv}[0]{\operatorname{div}}
\newcommand{\mygrad}[0]{\operatorname{grad}}
\newcommand{\mypartial}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\mypartialpow}[3]{\frac{\partial^{#3} #1}{\partial #2^{#3}}}
\newcommand{\myintegral}[2]{\int\limits_{#1}^{#2}}

\section{Теория}

Решаемое уравнение в общем виде в декартовой системе координат:

$$ -\mydiv\roubr{\lambda\mygrad u} + \gamma u + \sigma \mypartial{u}{t} + \chi \mypartialpow{u}{t}{2} = f $$

Первые краевые условия:

Эквивалентная постановка в форме уравнения Галёркина:

Аппроксимация уравнения Галёркина на конечномерных подпространствах:

Формулы для билинейных базисных функций прямоугольных элементов:

Аналитические выражения для вычисления элементов локальных матриц:

$$ G_{ij} = \myintegral{x_p}{x_{p+1}}\myintegral{y_s}{y_{s+1}} \lambda\roubr{\mypartial{\psi_i}{x}\mypartial{\psi_j}{x} + \mypartial{\psi_i}{y}\mypartial{\psi_j}{y}} \myd{x} \myd{y} $$

$$ M_{ij}^\gamma = \myintegral{x_p}{x_{p+1}}\myintegral{y_s}{y_{s+1}} \gamma \psi_i \psi_j \myd{x} \myd{y} $$

$$ b_i = \myintegral{x_p}{x_{p+1}}\myintegral{y_s}{y_{s+1}} f \psi_i \myd{x} \myd{y} $$

$$ \mb{G} = \frac{\bar{\lambda}}{6}\frac{h_y}{h_x}\begin{pmatrix}
2 & -2 & 1 & -1 \\
-2 & 2 & -1 & 1 \\
1 & -1 & 2 & -2 \\
-1 & 1 & -2 & 2
\end{pmatrix} + \frac{\bar{\lambda}}{6}\frac{h_x}{h_y}\begin{pmatrix}
2 & 1 & -2 & -1 \\
1 & 2 & -1 & -2 \\
-2 & -1 & 2 & 1 \\
-1 & -2 & 1 & 2
\end{pmatrix} $$

$$ \mb{C} = \frac{h_x h_y}{36}\begin{pmatrix}
4 & 2 & 2 & 1 \\
2 & 4 & 1 & 2 \\
2 & 1 & 4 & 2 \\
1 & 2 & 2 & 4
\end{pmatrix} $$

$$ \mb{M}^\gamma = \bar{\gamma}\mb{C} $$

$$ \mb{f} = \roubr{f_1, f_2, f_3, f_4}^t $$

$$ \mb{b} = \mb{C}\cdot \mb{f} $$

Схема Кранка-Николсона:

$$ \mypartial{u}{t} = \frac{u^j-u^{j-2}}{2\Delta t} $$

$$ \mypartialpow{u}{t}{2} = \frac{u^j-2u^{j-1}+u^{j-2}}{\Delta t^2} $$

$$ u = \frac{u^j+u^{j-2}}{2} $$

$$ f = \frac{f^j+f^{j-2}}{2} $$

$$ -\mydiv\roubr{\lambda \mygrad\frac{u^j+u^{j-2}}{2}} + \gamma \frac{u^j+u^{j-2}}{2} + \sigma \frac{u^j - u^{j-2}}{2\Delta t} + \chi \frac{u^j-2u^{j-1}+u^{j-2}}{\Delta t^2} = \frac{f^j+f^{j-2}}{2} $$

Подставляя это в уравнение Галёркина, получаем СЛАУ:

$$ \roubr{\frac{\mb{G}}{2} + \frac{\mb{M}^\gamma}{2} + \frac{\mb{M}^\sigma}{2\Delta t} + \frac{\mb{M}^\chi}{\Delta t^2}}\mb{q}^j = \frac{\roubr{\mb{b}^j+\mb{b}^{j-2}}}{2} - \frac{\mb{G}\mb{q}^{j-2}}{2} - \frac{\mb{M}^\gamma\mb{q}^{j-2}}{2} + \frac{\mb{M}^\sigma \mb{q}^{j-2}}{2\Delta t} - \frac{\mb{M}^\chi \roubr{-2\mb{q}^{j-1} + \mb{q}^{j-2}}}{\Delta t^2} $$

В нашем случае, так как $\gamma$, $\sigma$, $\chi$ являются константами, можно записать:

$$ \roubr{\frac{\mb{G}}{2} + \mb{C}\roubr{\frac{\gamma}{2} + \frac{\sigma}{2\Delta t} + \frac{\chi}{\Delta t^2}}}\mb{q}^j = \frac{\roubr{\mb{b}^j+\mb{b}^{j-2}}}{2} - \frac{\mb{G}\mb{q}^{j-2}}{2} + \mb{C}\roubr{\mb{q}^{j-1}\frac{2\chi}{\Delta t^2} + \mb{q}^{j-2}\roubr{-\frac{\gamma}{2}+\frac{\sigma}{2\Delta t}-\frac{\chi}{\Delta t^2}}} $$

Для неравномерной же сетки по времени имеем только отличие в:

$$ t_2 = t^{j-2},\quad t_1 = t^{j-1},\quad t_0 = t^j $$

$$ \mypartial{u}{t} = \frac{u^j-u^{j-2}}{t_2-t_1} = \frac{u^j-u^{j-2}}{d_1} $$

$$ \mypartialpow{u}{t}{2} = 2\frac{u^j-u^{j-1}\frac{t_0-t_2}{t_1-t_2}+u^{j-2}\frac{t_0-t_1}{t_1-t_2}}{t_0\roubr{t_0-t_1-t_2} + t_1 t_2} = \frac{u^j-u^{j-1}m_1+u^{j-2}m_2}{d_2} $$

Эти выражения были упрощены при помощи замен:

$$ d_1 = t_0-t_2, \quad d_2 = \frac{t_0\roubr{t_0-t_1-t_2} + t_1 t_2}{2}, \quad m_1 = \frac{t_0-t_2}{t_1-t_2}, \quad m_2 = \frac{t_0-t_1}{t_1-t_2} $$ 

И итоговый результат будет:

$$ \roubr{\frac{\mb{G}}{2} + \mb{C}\roubr{\frac{\gamma}{2} + \frac{\sigma}{d_1} + \frac{\chi}{d_2}}}\mb{q}^j = \frac{\roubr{\mb{b}^j+\mb{b}^{j-2}}}{2} - \frac{\mb{G}\mb{q}^{j-2}}{2} + \mb{C}\roubr{\mb{q}^{j-1}\frac{m_1\chi}{d_2} + \mb{q}^{j-2}\roubr{-\frac{\gamma}{2}+\frac{\sigma}{d_1}-\frac{m_2\chi}{d_2}}} $$

\section{Исследования}

\subsection{Таблицы}

\newcommand{\mytable}[1]{
\begin{center}
\noindent\pgfplotstabletypeset[
	columns={a,$t$,$t^2$,$t^3$,$t^4$,$e^t$},
	columns/a/.style={string type, column name={\backslashbox{$\operatorname{space}(x, y)$}{$\operatorname{time}(t)$}}},
	columns/$t$/.style={string type},
	columns/$t^2$/.style={string type},
	columns/$t^3$/.style={string type},
	columns/$t^4$/.style={string type},
	columns/$e^t$/.style={string type, column type/.add={}{|},},
	every head row/.style={before row=\hline,after row=\hline\hline}, 
	every last row/.style={after row=\hline},
	column type/.add={|}{},
	col sep=tab,
]{#1.txt}
\end{center}
}

\subsubsection{10 на 10 на 10}

% \mytable{functions_table_10_10_10}

\subsubsection{50 на 50 на 50}

% \mytable{functions_table_50_50_50}

\subsection{Неравномерные сетки}

\subsubsection{По пространству}

\newcommand{\includetwoimages}[1]{
\noindent\includegraphics[width=.49\textwidth]{#1_norm.png}\includegraphics[width=.49\textwidth]{#1_integral.png}
}

% \includetwoimages{space_tgrid_0}

% \includetwoimages{space_tgrid_1}

% \includetwoimages{space_tgrid_2}

\subsubsection{По времени}

\newcommand{\includetwographs}[1]{
\noindent\begin{tikzpicture}
\begin{semilogyaxis}[xlabel=t,ylabel=Интегральная разность,width=\textwidth, height=6cm]
\addplot[red, no markers] table [y=integral, x=t]{#1.txt};
\addplot[black, no markers] table [y=uniform_integral, x=t]{#1.txt};
\legend{Неравномерная сетка,Равномерная сетка}
\end{semilogyaxis}
\end{tikzpicture}

\noindent\begin{tikzpicture}
\begin{semilogyaxis}[xlabel=t,ylabel=Норма разности векторов,width=\textwidth, height=6cm]
\addplot[red, no markers] table [y=norm, x=t]{#1.txt};
\addplot[black, no markers] table [y=uniform_norm, x=t]{#1.txt};
\legend{Неравномерная сетка,Равномерная сетка}
\end{semilogyaxis}
\end{tikzpicture}
}

\includetwographs{time_tgrid_0}

\includetwographs{time_tgrid_1}

\includetwographs{time_tgrid_2}

\includetwographs{time_tgrid_3}

\includetwographs{time_tgrid_4}